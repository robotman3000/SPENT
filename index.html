<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta content="" name="description">
	<meta content="" name="author">
	<title>SPENT</title>
	
	<script type="text/javascript" src="/js/objlocks.js"></script>
	
	<!-- JQuery -->
	<script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>

	<!-- Bootstrap v4 -->
	<link rel="stylesheet" href="/css/bootstrap.min.css"><!-- v4.3.1 -->
	<script type="text/javascript" src="/js/bootstrap.bundle.min.js"></script><!-- v4.3.1 -->
	
	<!-- JSTree -->
	<link href="/css/jstree.min.css" rel="stylesheet"><!-- v3.3.8 -->
	<script type="text/javascript" src="/js/jstree.min.js"></script><!-- v3.3.8 -->
	<script type="text/javascript" src="/js/jstreegrid.js"></script><!-- v3.9.5 -->
	
	<!-- FooTable -->
	<link href="/css/font-awesome.min.css" rel="stylesheet"><!-- v4.7.0 -->
	<script type="text/javascript" src="/js/moment.js"></script><!-- v2.24.0 -->
	
	<link rel="stylesheet" type="text/css" href="/css/footable.standalone.css">
	<script type="text/javascript" charset="utf8" src="/js/footable.js"></script>
	
	<!-- SPENT -->
	<link href="/css/SPENT.css" rel="stylesheet">
	<script type="text/javascript" src="/js/SPENT.js"></script>
</head>
<body>		
	<div class="container-fluid p-0">
		
		<div class="row no-gutters">
			<div class="col">
				<nav class="navbar navbar-expand-sm bg-light navbar-light fixed-top" style="height: 56px">
					<a class="navbar-brand" href="#">SPENT</a>
					
					<!-- Toggler/collapsibe Button -->
					<!--button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="collapsibleNavbar"-->
						<ul class="nav nav-pills">
							<li class="nav-item">
								<a class="nav-link active" data-toggle="pill" href="#transactionTableTab">Trans</a>
							</li>
							<li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Manage</a>
								<div class="dropdown-menu">
									<button id="bucketTableModalToggle" class="dropdown-item">Buckets</button>
		  							<button id="accountTableModalToggle" class="dropdown-item">Accounts</button>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="#">Separated link</a>
								</div>
							</li>
							
						</ul>
					
					<!--/div-->
				</nav> 
			</div>
		</div>
			
		<div class="row no-gutters" style="margin-top: 56px; overflow-x: hidden;">
			
			<div class="col tab-content">
				
				<div class="tab-pane container-fluid active" id="transactionTableTab">
					<div class="row">
						<div class="col-md-4 col-lg-3">
							<div class="row bg-light">
								<p id="balanceDisplay" style="float: right; margin: auto;">Waiting on server for account balance...</p>
							</div>
							<div class="row">
								<div id="accountTree"></div>
							</div>
						</div>
						<div class="col-md-8 col-lg-9 p-0">
							<!-- Transaction Table -->
							<table id="transactionTable" class="table-striped table-hover" data-editing-always-show="true" data-paging="false" data-filtering="true" data-sorting="true" data-editing="true" data-state="false"></table>
						</div>
					</div>
				</div>
				
			</div>
			
		</div>
	</div>
	
	<!-- Account Table Modal -->
	<div id="accountTableModal" class="modal1">
		<!-- Modal content -->
		<div class="modal1-content">
			<span id="accountTableModalClose" class="modal1-close">&times;</span>
			<div id="accountTableEditToolbar"></div>
			<div class="modal1-scroll">
				<table id="accountTable" class="table-striped table-hover" data-editing-always-show="true" data-paging="false" data-filtering="false" data-sorting="true" data-editing="true" data-state="false"></table>
			</div>
		</div>
	</div>

	<!-- Bucket Table Modal -->
	<div id="bucketTableModal" class="modal1">
		<!-- Modal content -->
		<div class="modal1-content">
			<span id="bucketTableModalClose" class="modal1-close">&times;</span>
			<div id="bucketTableEditToolbar"></div>
			<div class="modal1-scroll">
				<table id="bucketTable" class="table-striped table-hover" data-editing-always-show="true" data-paging="false" data-filtering="false" data-sorting="true" data-editing="true" data-state="false"></table>
			</div>
		</div>
	</div>
	
	<!-- Transaction Edit Form Modal -->
	<div id="transactionTableEditFormModal" class="modal1">
		<!-- Modal content -->
		<div class="modal1-content">
			<span id="transactionTableEditFormModalClose" class="modal1-close">&times;</span>
			<div class="modal1-scroll">
				<div id="transactionTableEditFormDiv"></div>
			</div>
		</div>
	</div>

	<!-- Account Edit Form Modal -->
	<div id="accountTableEditFormModal" class="modal1">
		<!-- Modal content -->
		<div class="modal1-content">
			<span id="accountTableEditFormModalClose" class="modal1-close">&times;</span>
			<div class="modal1-scroll">
				<div id="accountTableEditFormDiv"></div>
				
			</div>
		</div>
	</div>
	
	<!-- Bucket Edit Form Modal -->
	<div id="bucketTableEditFormModal" class="modal1">
		<!-- Modal content -->
		<div class="modal1-content">
			<span id="bucketTableEditFormModalClose" class="modal1-close">&times;</span>
			<div class="modal1-scroll">
				<div id="bucketTableEditFormDiv"></div>
			</div>
		</div>
	</div>
	
	<script>
		function registerModal(name){
			// Get the modal
			var modal = document.getElementById(name);

			// Get the button that opens the modal
			var btn = document.getElementById(name + "Toggle");

			// Get the <span> element that closes the modal
			var span = document.getElementById(name + "Close");

			if(btn){
				// When the user clicks on the button, open the modal
				btn.onclick = function() {
					showModal(name);
				}
			}

			if(span){
				// When the user clicks on <span> (x), close the modal
				span.onclick = function() {
					hideModal(name);
				}
			}

			// When the user clicks anywhere outside of the modal, close it
			/*window.onclick = function(event) {
				if (event.target == modal) {
					if(modal){
						modal.style.display = "none";
					}
				}
			} */	
		}
		
		function showModal(name){
			var modal = document.getElementById(name);
			modal.style.display = "block";
		}
		
		function hideModal(name){
			var modal = document.getElementById(name);
			modal.style.display = "none";
		}
		
		function dateToStr(d){
			var month = '' + (d.getMonth() + 1),
				day = '' + d.getDate(),
				year = d.getFullYear();

			if (month.length < 2) month = '0' + month;
			if (day.length < 2) day = '0' + day;

			return [year, month, day].join('-');

		}
		
		function updateFormContent(name, data){
			var form = $("#" + name);
			
			// Input Elements
			var inputs = form.find("input").toArray();
			inputs.forEach(function(item, index){
				if (!(item.type == "submit")){
					var key = item.name;
					var oldValue = getOrDefault(data, key, "");
					if(oldValue.toDate){
					   oldValue = dateToStr(oldValue.toDate());
					}
					$(item).val(oldValue);
				}
			});
			
			//Select Elements
			var inputs = form.find("select").toArray();
			inputs.forEach(function(item, index){
				var key = item.name;
				var oldValue = getOrDefault(data, key, null);
				if(oldValue == null){
					item.selectedIndex = 0;
				} else {
					$(item).val(oldValue);
				}
			});
			
			
			//TODO: This should not return the form
			// It is just a quick fix
			return form;
		}
		
		$(document).ready(function() {
			registerModal("bucketTableModal");
			registerModal("accountTableModal");
			
			registerModal("transactionTableEditFormModal");
			registerModal("bucketTableEditFormModal");
			registerModal("accountTableEditFormModal");
			
			//openNav('sidebar'); //TODO: The sidebar needs its defaults set
			onDocumentReady();
		});
	</script>
</body>