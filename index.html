<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
	<meta content="" name="description">
	<meta content="" name="author">
	<title>SPENT</title>
	
	<!-- JQuery -->
	<script src="/js/jquery-3.4.1.min.js"></script>

	<!-- JSTree -->
	<script type="text/javascript" src="/js/jstree.min.js"></script><!-- v3.3.8 -->
	<link href="/css/jstree.min.css" rel="stylesheet"><!-- v3.3.8 -->
	<script type="text/javascript" src="/js/jstreegrid.js"></script><!-- v3.9.5 -->
	
	<!-- SPENT -->
	<link href="/css/SPENT.css" rel="stylesheet">
	<script type="text/javascript" src="/js/SPENT.js"></script>
	
	<!-- FooTable -->
	<link rel="stylesheet" type="text/css" href="/css/footable.standalone.css">
	<script type="text/javascript" charset="utf8" src="/js/footable.js"></script>
	
	<script type="text/javascript" src="/js/moment.js"></script><!-- v2.24.0 -->
	<link href="/css/font-awesome.min.css" rel="stylesheet"><!-- v4.7.0 -->
</head>
<body>
	<!-- Sidebar -->
	<div id="sidebar-sidebar" class="sidebar-sidebar">
		<span>
			<a href="javascript:void(0)" class="sidebar-close" onclick='closeNav("sidebar")' style="visibility: hidden">&times;</a>
			<h3 id="title">SPENT</h3>
		</span>
		<ul class="button-stack">
		  <li><button id="bucketTableModalToggle">Edit Buckets</button></li>
		  <li><button id="accountTableModalToggle">Edit Accounts</button></li>
		</ul>
		<div id="accountTree"></div>
	</div>
	<div id="sidebar-main" class="sidebar-main">
		<div>
			<button onclick='openNav("sidebar")' style="float: left; visibility: hidden">&#9776;</button>
			<div id="transactionTableEditToolbar"></div>
			<p id="balanceDisplay" style="float: right; margin: auto;">Waiting on server for account balance...</p>
		</div>
		
		<div class="scrollmenu">
			<!-- Transaction Table -->
			<table id="transactionTable" data-paging="false" data-filtering="false" data-sorting="true" data-editing="true" data-state="false"></table>
		</div>
	</div>
	
	<!-- Account Table Modal -->
	<div id="accountTableModal" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
			<span id="accountTableModalClose" class="modal-close">&times;</span>
			<div id="accountTableEditToolbar"></div>
			<div class="modal-scroll">
				<table id="accountTable" data-paging="false" data-filtering="false" data-sorting="true" data-editing="true" data-state="false"></table>
			</div>
		</div>
	</div>

	<!-- Bucket Table Modal -->
	<div id="bucketTableModal" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
			<span id="bucketTableModalClose" class="modal-close">&times;</span>
			<div id="bucketTableEditToolbar"></div>
			<div class="modal-scroll">
				<table id="bucketTable" data-paging="false" data-filtering="false" data-sorting="true" data-editing="true" data-state="false"></table>
			</div>
		</div>
	</div>
	
	<!-- Transaction Edit Form Modal -->
	<div id="transactionTableEditFormModal" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
			<span id="transactionTableEditFormModalClose" class="modal-close">&times;</span>
			<div class="modal-scroll">
				
				<div id="transactionTableEditFormDiv"></div>
				
			</div>
		</div>
	</div>
	
	<!-- Account Edit Form Modal -->
	<div id="accountTableEditFormModal" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
			<span id="accountTableEditFormModalClose" class="modal-close">&times;</span>
			<div class="modal-scroll">
				
				<div id="accountTableEditFormDiv"></div>
				
			</div>
		</div>
	</div>
	
	<!-- Bucket Edit Form Modal -->
	<div id="bucketTableEditFormModal" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
			<span id="bucketTableEditFormModalClose" class="modal-close">&times;</span>
			<div class="modal-scroll">
				
				<div id="bucketTableEditFormDiv"></div>
				
			</div>
		</div>
	</div>
	<script>
		function registerModal(name){
			// Get the modal
			var modal = document.getElementById(name);

			// Get the button that opens the modal
			var btn = document.getElementById(name + "Toggle");

			// Get the <span> element that closes the modal
			var span = document.getElementById(name + "Close");

			if(btn){
				// When the user clicks on the button, open the modal
				btn.onclick = function() {
					showModal(name);
				}
			}

			if(span){
				// When the user clicks on <span> (x), close the modal
				span.onclick = function() {
					hideModal(name);
				}
			}

			// When the user clicks anywhere outside of the modal, close it
			window.onclick = function(event) {
				if (event.target == modal) {
					if(modal){
						modal.style.display = "none";
					}
				}
			} 	
		}
		
		function showModal(name){
			var modal = document.getElementById(name);
			modal.style.display = "block";
		}
		
		function hideModal(name){
			var modal = document.getElementById(name);
			modal.style.display = "none";
		}
		
		function updateFormContent(name, data){
			var form = document.getElementById(name);
			var inputs = $("#" + name).find("input").toArray();
			inputs.forEach(function(item, index){
				if (!(item.type == "submit")){
					var key = item.name;
					var oldValue = getOrDefault(data, key, "");
					item.value = oldValue;
				}
			});
			
			//TODO: This should not return the form
			// It is just a quick fix
			return form;
		}
			
		//TODO: Allow custom widths
		/* Set the width of the sidebar to 250px and the left margin of the page content to 250px */
		/*function openNav(name) {
			document.getElementById(name + "-sidebar").style.width = "16em";
			document.getElementById(name + "-main").style.marginLeft = "16em";
		}*/

		/* Set the width of the sidebar to 0 and the left margin of the page content to 0 */
		/*function closeNav(name) {
			document.getElementById(name + "-sidebar").style.width = "0";
			document.getElementById(name + "-main").style.marginLeft = "0";
		} */
		
		$(document).ready(function() {
			registerModal("bucketTableModal");
			registerModal("accountTableModal");
			
			registerModal("transactionTableEditFormModal");
			registerModal("bucketTableEditFormModal");
			registerModal("accountTableEditFormModal");
			
			//openNav('sidebar'); //TODO: The sidebar needs its defaults set
			onDocumentReady();
		});
	</script>
</body>
</html>