<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link href="https://cdn.jsdelivr.net/npm/@inkline/inkline/dist/inkline.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

        <script type="text/javascript" src="https://momentjs.com/downloads/moment.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="https://unpkg.com/vuex@3.5.1/dist/vuex.js"></script>
        <script src="https://unpkg.com/@vuex-orm/core"></script>
        <script src="https://cdn.jsdelivr.net/npm/@inkline/inkline/dist/inkline.js"></script>
        <script src="/js/SPENT.js" type="text/javascript"></script>
        <style>
            .nodeSelected {
                background-color: skyblue;
            }
            .tree-root li .tree-item:nth-of-type(even){
                background: #e0e0e0;
            }
            .nodeClosed {
                display: none;
            }
            .tree-item {
                transition: 0.3s;
            }
            .tree-item:hover {
                background-color: lightblue;
            }
            .scrollFix {
                max-height: 258px;
                overflow-y: scroll;
            }
        </style>
    </head>
    <body>
        <div id="spent">
            <i-container class="_margin-0 _padding-0 _max-width-100">
                <!--i-row>
                    <i-column xs="12">
                        <i-alert variant="info">
                            <template slot="icon"><i-icon icon="info"></i-icon></template>
                            <p>Some quick example text to build on the alert title and make up the bulk of the alert's content.</p>
                        </i-alert>
                    </i-column>
                </i-row-->
                <i-row>
                    <i-column xs="12">
                        <i-navbar :collapse="false">
                            <i-navbar-brand>SPENT</i-navbar-brand>
                            <i-navbar-items class="_justify-content-center">
                                <i-nav>
                                    <!--i-nav-item>Save</i-nav-item-->
                                    <i-button-group>
                                        <!--i-button variant="primary" @click="showBucketTableModal = true">Manage Buckets</i-button-->
                                        <i-button variant="primary" @click="onNewTransactionClick">New Transaction</i-button>
                                        <!--i-button variant="primary">Transaction Filter</i-button-->
                                        <i-button :variant="clickModeToggle ? 'primary' : 'danger'" @click="clickModeToggle = !clickModeToggle">{{ clickModeToggle ? "Edit Mode" : "Delete Mode"}}</i-button>
                                        <i-button :variant="tagModeToggle ? 'primary' : 'secondary'" @click="tagModeToggle = !tagModeToggle">{{ tagModeToggle ? "Transaction Mode" : "Tag Mode"}}</i-button>
                                        <i-button variant="primary" @click="refreshBalance">Refresh Balance</i-button>
                                        <i-button variant="primary" @click="showTagTableModal = true">Edit Tags</i-button>
                                    </i-button-group>
                                </i-nav>
                            </i-navbar-items>
                        </i-navbar>
                    </i-column>
                </i-row>
                <i-row>
                    <i-column xs="3">
                        <i-row>
                            <i-column xs="12">
                                <table bordered style="width: 100%" v-if="selectedBucket">
                                    <thead>
                                        <th></th>
                                        <th>Posted</th>
                                        <th>Available</th>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th>Current</th>
                                            <td><currency-display :balance-obj="selectedBucket.postedBalance"></currency-display></td>
                                            <td><currency-display :balance-obj="selectedBucket.availableBalance"></currency-display></td>
                                        </tr>
                                        <tr>
                                            <th>Tree</th>
                                            <td><currency-display :balance-obj="selectedBucket.postedTreeBalance"></currency-display></td>
                                            <td><currency-display :balance-obj="selectedBucket.availableTreeBalance"></currency-display></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div v-else>
                                    Loading Balances
                                </div>
                            </i-column>
                        </i-row>
                        <i-row>
                            <i-column xs="12">
                                <i-button-group>
                                    <i-button variant="primary" @click="onNewBucketClick"><i-icon icon="plus" /><i-icon icon="file" /></i-button>
                                    <i-button variant="primary" @click="onNewAccountClick"><i-icon icon="plus" /><i-icon icon="folder" /></i-button>
                                </i-button-group>
                                <i-button-group>
                                    <i-button :variant="showTree ? 'primary' : 'secondary'" @click="showTree = !showTree">{{ showTree ? "Tree" : "Local"}}</i-button>
                                    <i-button :variant="clickModeToggle2 ? 'primary' : 'danger'" @click="clickModeToggle2 = !clickModeToggle2">{{ clickModeToggle2 ? "Select Mode" : "Edit Mode"}}</i-button>
                                </i-button-group>
                            </i-column>
                        </i-row>
                        <i-row>
                            <i-column xs="12">
                                <tree-view v-show="buckets.length > 0" class="item" :nodes="buckets" :selectednode="selectedBucketID" @node-click="onBucketTreeClick"></tree-view>
                                <p v-show="buckets.length == 0">No Accounts</p>
                            </i-column>
                        </i-row>
                    </i-column>
                    <i-column xs="9">
                        <!--i-row>
                            <i-column>
                                <i-nav>
                                    <i-button-group>
                                        <i-button variant="primary" @click="onNewTransactionClick">New Transaction</i-button>
                                        <i-button variant="primary" @click="onNewBucketClick">New Bucket</i-button>
                                        <--i-button variant="primary">Transaction Filter</i-button>
                                        <i-button :variant="clickModeToggle ? 'primary' : 'danger'" @click="clickModeToggle = !clickModeToggle">{{ clickModeToggle ? "Edit Mode" : "Delete Mode"}}</i-button>
                                    </i-button-group>
                                </i-nav>
                            </i-column>
                        </i-row-->
                        <i-row>
                            <i-column>
                                <i-datatable v-show="transactions.length > 0" hover border striped :columns="transactionColumns" :rows="transactions" :pagination="false" :count-column="false" @tr-click="onTransTableRowClick"></i-datatable>
                                <p v-show="transactions.length == 0">No Transactions</p>
                            </i-column>
                        </i-row>
                    </i-column>
                </i-row>
                <i-row><i-column xs="12">Footer</i-column></i-row>
            </i-container>
            <div>
                <i-modal v-model="showTransactionFormModal">
                    <template slot="header">Edit Transaction</template>
                    <transaction-form :form-schema="transSchema" :status-options="statusOptions" :bucket-options="bucketOptions" @form-submit="onFormSubmit"></transaction-form>
                    <!--template slot="footer">Modal Footer</template-->
                </i-modal>
                <i-modal v-model="showBucketFormModal">
                    <template slot="header">Edit Bucket</template>
                    <bucket-form :form-schema="bucketSchema" :bucket-options="bucketOptions" :account-options="accountOptions" @form-submit="onFormSubmit"></bucket-form>
                    <!--template slot="footer">Modal Footer</template-->
                </i-modal>
                <i-modal v-model="showAccountFormModal">
                    <template slot="header">Edit Account</template>
                    <account-form :form-schema="accountSchema" @form-submit="onFormSubmit"></account-form>
                    <!--template slot="footer">Modal Footer</template-->
                </i-modal>
                <i-modal v-model="showBucketTableModal">
                    <template slot="header">Manage Accounts</template>
                    <i-tabs>
                        <i-tab title="Accounts">
                            <i-datatable hover border striped :columns="accountColumns" :rows="accounts" :pagination="false" :count-column="false" @tr-click="onAccountTableRowClick"></i-datatable>
                        </i-tab>
                        <i-tab title="Buckets">
                            <i-datatable hover border striped :columns="bucketColumns" :rows="buckets" :pagination="true" :count-column="false" @tr-click="onBucketTableRowClick"></i-datatable>
                        </i-tab>
                    </i-tabs>
                    <!--template slot="footer">Modal Footer</template-->
                </i-modal>
                <i-modal v-model="showTagTableModal">
                    <template slot="header">Edit Tags</template>
                    <i-button-group>
                        <i-button variant="primary" @click="onNewTagClick">New Tag</i-button>
                        <i-button :variant="clickModeToggle ? 'primary' : 'danger'" @click="clickModeToggle = !clickModeToggle">{{ clickModeToggle ? "Edit Mode" : "Delete Mode"}}</i-button>
                    </i-button-group>
                    <i-datatable hover border striped :columns="tagColumns" :rows="tags" :pagination="true" :count-column="false" @tr-click="onTagTableRowClick"></i-datatable>
                    <!--template slot="footer">Modal Footer</template-->
                </i-modal>
                <i-modal v-model="showTagFormModal">
                    <template slot="header">Edit Tag</template>
                    <tag-form :form-schema="tagSchema" @form-submit="onFormSubmit"></tag-form>
                    <!--template slot="footer">Modal Footer</template-->
                </i-modal>
            </div>
        </div>
        <script type="text/javascript">
            bootstrapSPENT();
        </script>
    </body>
</html>
